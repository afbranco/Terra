---
---
{% include header.html %}

<h2>Tutorial</h2>

<p>First we present the programming flow, then we present a example of how to compile and load a script using the available tools.</p>

<H3>1 - Programming flow </H3>

<p>After VM-T is loaded at all network nodes,
the user can upload his script to be disseminated via radio to the network nodes.</p>

<p>The VM is typically loaded over a wired interface for each node as for any TinyOS program.
It is also possible to run a simulated version of VM-T in the TOSSIM TinyOS Simulator 
or in emulators like AVRORA and COOJA.</p>

<p>In a typical use of Terra, the programmer writes a Céu-T script, compiles it, and uploads its bytecode to the network. 
The compilation process must include a specific Terra configuration file for the chosen virtual machine.
The Céu-T script can only use events and functions defined in the configuration file.
The generated bytecode must then be disseminated over the WSN using Terra's upload tool.
This tool transfers the bytecode to the basestation node connected to the computer via wired interface.
The base station node then starts the dissemination algorithm to send the bytecode script, which is divided in blocks, to all nodes. 
This is a basic flooding algorithm where all nodes forward each incoming message until all nodes are reached. 
</p>
<p>Figure 2 presents the compilation and load flow.</p>

<figure>
<img style="border: 0px solid ; width: 640px; height: 194px;" alt="Terra Flow" src="images/TerraFlow.png" align="center" hspace="1" vspace="10">
<figcaption>Fig2.: Terra programing flow.</figcaption>
</figure>

<br>
<h3>2 - Simple Tutorial</h3>

<h4>2.1 - Script compilation</h4>

<ul>
<li>Start TerraNG virtual machine - password: terra (See Download section)</li>
<li>Select the icon <code>src</code> to open a file manager in the script source directory (~/TerraNG/src).</li>
<li>Double click the <code>blink_tutorial.terra</code> file to open it in the <i>gedit</i> editor.</li>
<li>Take a look in the code to identify the main controls.</li>
<ul>
 <li>The first line is the command to include the VM-T specific customization. Based on this file the Terra compiler checks the available events, functions and custom data structures.</li>
 <li>The script body is divided in three blocks, where each block controls one of the three LEDs on the sensor board. A <code>par do ... with ... end</code> executes each block in paralel.</li>
 <li>A <code>await 1s;</code> command is used to suspend the execution of its block by one second. This command, inside a <code>loop do ... end</code>, builds a periodic timer. The <code>emit LED0(TOGGLE);</code> toggles the status of the LED.</li>
</ul>
<li>Pressing the <code>F5</code> key in the keyboard will compile this code . This key starts the Terra compiler for current opened file. The compiler output is generated in the lower area in the gedit window.</li>
</ul>
<br>
<p>If everything is OK, the compiler will generate the output presented in Figure 3.</p>

<figure>
<img style="border: 0px solid ; width: 640px; height: 480px;" alt="Terra Flow" src="images/CompileOutput.png" align="center" hspace="1" vspace="10">
<figcaption>Fig3.: Terra compile output example.</figcaption>
</figure>

<br>
<p>The compiler generates a new file using the same name of the script, but with the <code>.vmx</code> suffix. This file contains the bytecode necessary to run the script in the specific VM-T customization.</p>

<br>
<h4>2.2 - Script dissemination - using the simulator</h4>

<ul>
<li>Select the icon <code>TOSSIM Net</code> to open the pre-configured TOSSIM simulator.</li>
<p>The pre-configured simulation creates a WSN network in a grid mode (rows and columns). Each radio reach up to its one hop neighbor.
The default operation will start a window with three nodes.
The node 1 is the base-station and communicates only with node 11. This node doesn't run the script, it is used only to support the dissemination process and data communication  by wired interface.
Depending the way the simulator is started, others nodes will appear identified by a number based on the column and row number. The number 9 is the maximum for rows and columns.</p>
<li>Select the icon <code>Terra control</code> to open the Terra control tool. This tool is used to select a specific script and start the code dissemination operation.</li>
<li>In the first tab <code>Control</code> you can select the application folder where the <code>.vmx</code> file is stored. You must change it to the path: <code>/home/terra/TerraNG/src/</code>.</li>
<li>In the Application file control select the <code>blink_tutorial</code> script.</li>
<li>If the simulator is running, you will see a TCP ON message in the lower area and the Load New Application button will be enabled. Select this button to start the dissemination operation.</li>
</ul>
<b>Obs.:</b>
<ul>
<li>Some menu icons has more options when selected with right button.</li>
<li>Sometimes the start dissemination message may fail to reach the base-station node and the user must repeat the operation clicking again in the button.</li>
</ul>
<br>
<p>The Figure 4 presents the tipical dissemination output and Figure 5 presents the simulator window.<p>

<figure>
<img style="border: 0px solid ; width: 640px; height: 480px;" alt="Terra Flow" src="images/DisseminationOutput.png" align="center" hspace="1" vspace="10">
<figcaption>Fig4.: Dissemination output example.</figcaption>
</figure>
<br>
<figure>
<img style="border: 0px solid ; width: 640px; height: 480px;" alt="Terra Flow" src="images/SimulatorOutput.png" align="center" hspace="1" vspace="10">
<figcaption>Fig5.: Simulator example.</figcaption>
</figure>


{% include footer.html %}







